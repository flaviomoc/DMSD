---
title: "DMSD Vignette"
author: "FlÃ¡vio Mota"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{DMSD-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Introduction
*DMSD* is a package created to calculate Diversity Metrics from Spatialized Data. It is an alternative to process big datasets with less memory usage. The functions of this package can calculate spatial and temporal beta diversity, separating the turnover and nestedness components of taxonomic, functional, and phylogenetic diversity.

## Loading data
```{r, fig.height = 5, fig.width = 8, fig.align = 'center',}
library(terra)
library(BAT)
library(DMSD)
library(FD)

# Create SpatRaster objects
set.seed(100)
ref <- terra::rast(array(sample(c(rep(1, 800), rep(0, 200))), dim = c(10, 10, 10)))
names(ref) <- paste0("sp", 1:10)
ref
fut <- terra::rast(array(sample(c(rep(1, 400), rep(0, 600))), dim = c(10, 10, 10)))
names(fut) <- names(ref)
fut

# Create data.frame object
set.seed(100)
mass <- runif(10, 10, 800)
beak.size <- runif(10, .2, 5)
tail.length <- runif(10, 2, 10)
wing.length <- runif(10, 15, 60)
range.size <- runif(10, 10000, 100000)
traits <- data.frame(mass, beak.size, tail.length, wing.length, range.size)
rownames(traits) <- names(ref)
traits

# Create phylo object
set.seed(100)
tree <- ape::rtree(n = 10, tip.label = paste0("sp", 1:10))
tree
```

## Calculating alpha of taxonomic diversity
It is a spatial representation of *species richness* of a given scenario calculated by the sum of the same cell of each species.
```{r, fig.height = 4, fig.width = 5, fig.align = 'center',}
# Alpha diversity for reference scenario
r.rich <- alphadv(ref)
r.rich
terra::plot(r.rich, main = names(r.rich))

# Alpha diversity for future scenario
f.rich <- alphadv(fut)
f.rich
terra::plot(f.rich, main = names(f.rich))
```

## Calculating beta temporal of taxonomic diversity
It is a spatial representation of *species composition* change between two scenarios. It indicates the differentiation in communities from the reference scenario to the future scenario by cell. Higher values of *beta diversity* means higher changes, which can be due to species replacement, *turnover*, or species gain/loss, *nestedness*.
```{r, fig.height = 4, fig.width = 5, fig.align = 'center',}
# Beta total
beta.td <- betatemp_td(ref, fut)
beta.td
terra::plot(beta.td[[1]], main = names(beta.td[[1]]))

# Turnover
terra::plot(beta.td[[2]], main = names(beta.td[[2]]))

# Nestedness
terra::plot(beta.td[[3]], main = names(beta.td[[3]]))
```

## Calculating trait generalization
It is a spatial representation of the *average* of a given trait.
```{r, fig.height = 4, fig.width = 5, fig.align = 'center',}
# Ecological generalization for the trait mass
mass.ref <- ecogen(ref, traits$mass) # reference scenario
mass.ref
terra::plot(mass.ref, main = names(mass.ref))

mass.fut <- ecogen(fut, traits$mass) # future scenario
mass.fut
terra::plot(mass.fut, main = names(mass.fut))
```
## Calculating *Functional richness*
It represents the functional space filled by a community (convexhull volume).
```{r, fig.height = 4, fig.width = 5, fig.align = 'center',}
# Alpha functional diversity for reference scenario
r.rich.fd <- alphadv_fd(ref, traits)
r.rich.fd
terra::plot(r.rich.fd, main = names(r.rich.fd))

## Standardized functional richness (null model)
r.ses.fd <- ses_fd(r.rich.fd)
r.ses.fd
terra::plot(r.ses.fd[[4]], main = "ref SES FD")
```

## Calculating beta temporal of functional diversity
It is a representation of *functional space* change between two scenarios. It indicates the differentiation in communities from the reference scenario to the future scenario by cell. Higher values of *functional beta diversity* means higher changes, which can be due to species replacement of functions, *turnover*, or  gain/loss of functions, *nestedness*.
```{r, fig.height = 4, fig.width = 5, fig.align = 'center',}
# Beta total
beta.fd <- betatemp_fd(ref, fut, traits)
beta.fd
terra::plot(beta.fd[[1]], main = names(beta.fd[[1]]))

# Turnover
terra::plot(beta.fd[[2]], main = names(beta.fd[[2]]))

# Nestedness
terra::plot(beta.fd[[3]], main = names(beta.fd[[3]]))
```

## Calculating beta temporal of phylogenetic diversity
It is a representation of the change in *phylogenetic relationship* of species between two scenarios. It indicates the differentiation in communities from the reference scenario to the future scenario by cell. Higher values of *phylogenetic beta diversity* means higher changes, which can be due to species replacement, *turnover*, or gain/loss, *nestedness*.
```{r, fig.height = 4, fig.width = 5, fig.align = 'center',}
# Beta total
beta.pd <- betatemp_pd(ref, fut, tree)
beta.pd
terra::plot(beta.pd[[1]], main = names(beta.pd[[1]]))

# Turnover
terra::plot(beta.pd[[2]], main = names(beta.pd[[2]]))

# Nestedness
terra::plot(beta.pd[[3]], main = names(beta.pd[[3]]))
```
