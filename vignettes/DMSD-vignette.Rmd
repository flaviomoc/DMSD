---
title: "DMSD Vignette"
author: "FlÃ¡vio Mota"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{DMSD-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Introduction
*DMSD* is a package created to calculate Diversity Metrics from Spatialized Data. It is an alternative to process big datasets with less memory usage. The functions of this package can calculate spatial and temporal beta diversity, separating the turnover and nestedness components of taxonomic, functional, and phylogenetic diversity.

## Loading data
```{r, fig.height = 5, fig.width = 8, fig.align = 'center',}
library(terra)
library(betapart)
library(DMSD)
library(FD)

# SpatRaster
set.seed(100)
ref <- terra::rast(array(sample(c(rep(1, 800), rep(0, 200))), dim = c(10, 10, 10)))
names(ref) <- paste0("sp", 1:10)
ref
fut <- terra::rast(array(sample(c(rep(1, 400), rep(0, 600))), dim = c(10, 10, 10)))
names(fut) <- names(ref)
fut

# data.frame
set.seed(100)
mass <- runif(10, 10, 800)
beak.size <- runif(10, .2, 5)
tail.length <- runif(10, 2, 10)
wing.length <- runif(10, 15, 60)
range.size <- runif(10, 10000, 100000)
traits <- data.frame(mass, beak.size, tail.length, wing.length, range.size)
rownames(traits) <- names(ref)
traits
```

## Calculating alpha diversity
It is a spatial representation of *species richness* of a given scenario calculated by the sum of the same cell of each species.
```{r, fig.height = 4, fig.width = 5, fig.align = 'center',}
# alpha diversity for reference scenario
r.rich <- alphadv(ref)
r.rich
terra::plot(r.rich, main = names(r.rich))

# alpha diversity for future scenario
f.rich <- alphadv(fut)
f.rich
terra::plot(f.rich, main = names(f.rich))
```

## Calculating beta diversity
It is a spatial representation of *species composition* change between two scenarios. It indicates the differentiation in communities from the reference scenario to the future scenario by cell. Higher values of *beta diversity* means higher changes, which can be by species replacement, *turnover*, or species gain/loss, *nestedness*. The *ratio* is calculated dividing the *turnover* by the *total beta diversity*, thus, values close to 1 indicates predominance of *turnover* component while values close to 0 indicates predominance of *nestedness* component.
```{r, fig.height = 4, fig.width = 5, fig.align = 'center',}
# total beta diversity between scenarios
beta <- betatempdv(ref, fut)
beta
terra::plot(beta[[1]], main = names(beta[[1]]))

# turnover component
terra::plot(beta[[2]], main = names(beta[[2]]))

# nestedness component
terra::plot(beta[[3]], main = names(beta[[3]]))

# ratio (turnover/total beta diversity)
terra::plot(beta[[4]], main = names(beta[[4]]))
```

## Calculating trait generalization
It is a spatial representation of the *average* of a given trait.
```{r, fig.height = 4, fig.width = 5, fig.align = 'center',}
# ecological generalization for the trait mass
mass.ref <- ecogen(ref, traits$mass) # reference scenario
mass.ref
terra::plot(mass.ref, main = names(mass.ref))

mass.fut <- ecogen(fut, traits$mass) # future scenario
mass.fut
terra::plot(mass.fut, main = names(mass.fut))
```
## Calculating *Functional richness*
It represents the functional space filled by a community (convexhull volume).
```{r, fig.height = 4, fig.width = 5, fig.align = 'center',}
# alpha functional diversity for reference scenario
r.rich.fd <- alphadv_fd(ref, traits)
r.rich.fd
terra::plot(r.rich.fd, main = names(r.rich.fd))

## standardized functional richness (null model)
r.ses.fd <- ses_fd(r.rich.fd)
r.ses.fd
terra::plot(r.ses.fd[[4]], main = "ref SES FD")
```

## Calculating functional beta diversity
It is a representation of *functional space* change between two scenarios. It indicates the differentiation in communities from the reference scenario to the future scenario by cell. Higher values of *functional beta diversity* means higher changes, which can be by species replacement of functions, *turnover*, or  gain/loss of functions, *nestedness*.
```{r, fig.height = 4, fig.width = 5, fig.align = 'center',}
# total functional beta diversity between scenarios
beta.fd <- betatemp_fd_sp(ref, fut, traits)
beta.fd
terra::plot(beta.fd[[1]], main = names(beta.fd[[1]]))

# turnover component
terra::plot(beta.fd[[2]], main = names(beta.fd[[2]]))

# nestedness component
terra::plot(beta.fd[[3]], main = names(beta.fd[[3]]))
```
